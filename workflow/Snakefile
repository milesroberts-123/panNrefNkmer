# load packages

import pandas as pd
import os
from snakemake.utils import validate
from snakemake.utils import min_version

min_version("9.3.3")

# configuration
configfile: "../config/config.yaml"


#validate(config, "../config/config.schema.yaml")


# container version of workflow
#containerized: "docker://milesroberts/poolseq-kmers"


# load samples
#parameters = pd.read_table(
#    "../config/parameters.tsv", sep="\t", dtype={"ID": str}
#).set_index(["ID"], drop=False)

#validate(parameters, "../config/parameters.schema.yaml")

rule all:
    input:
        expand("{ID}_{ref}.done", ID = config["samples"], ref = config["linrefs"]),
        expand("{ID}_{ref}.done", ID = config["samples"], ref = config["panrefs"])

rule all_per_id:
    input:
        "no_contam_reads/{ID}.fastq",
        "vg_results/{ID}_{ref}.bam"
    output:
        "{ID}_{ref}.done"

include: "rules/datasets.smk"
include: "rules/sra.smk"
include: "rules/fastp.smk"
include: "rules/kmc_contam_db.smk"
include: "rules/kmc_rm_contam.smk"
include: "rules/vg_index.smk"
include: "rules/vg_map.smk"
include: "rules/vg_filter.smk"
include: "rules/vg_surject.smk"
